{"version":3,"file":"login-main.js","sources":["../src/actions/login/login-main.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\n\nimport * as core from '@actions/core'\nimport YAML from 'yaml'\n\nimport {\n  cliConfigPath,\n  cliCredentialsPath,\n  configPath\n} from '../../constants/path'\nimport {getRequiredEnvParam} from '../../utils/action'\n\nimport execute from './login-execute'\n\nasync function run(): Promise<void> {\n  try {\n    const config = {\n      baseUrl: getRequiredEnvParam('JIRA_BASE_URL'),\n      email: getRequiredEnvParam('JIRA_USER_EMAIL'),\n      token: getRequiredEnvParam('JIRA_API_TOKEN')\n    }\n\n    const response = await execute(config)\n\n    if (response) {\n      if (!fs.existsSync(configPath)) {\n        fs.mkdirSync(path.dirname(configPath), {recursive: true})\n      }\n\n      fs.writeFileSync(configPath, YAML.stringify(config))\n\n      if (!fs.existsSync(cliConfigPath)) {\n        fs.mkdirSync(path.dirname(cliConfigPath), {recursive: true})\n      }\n\n      fs.writeFileSync(\n        cliConfigPath,\n        YAML.stringify({\n          endpoint: config.baseUrl,\n          login: config.email\n        })\n      )\n\n      fs.writeFileSync(cliCredentialsPath, `JIRA_API_TOKEN=${config.token}`)\n\n      return\n    }\n\n    console.log('Failed to login.')\n    return\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error)\n    core.setFailed(message)\n    console.log(error)\n    return\n  }\n}\n\nvoid run()\n"],"names":["getRequiredEnvParam","execute","configPath","path","YAML","cliConfigPath","cliCredentialsPath","core.setFailed"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAeA,eAAe,GAAG,GAAA;IAChB,IAAI;AACF,QAAA,MAAM,MAAM,GAAG;AACb,YAAA,OAAO,EAAEA,0BAAmB,CAAC,eAAe,CAAC;AAC7C,YAAA,KAAK,EAAEA,0BAAmB,CAAC,iBAAiB,CAAC;AAC7C,YAAA,KAAK,EAAEA,0BAAmB,CAAC,gBAAgB,CAAC;SAC7C,CAAA;AAED,QAAA,MAAM,QAAQ,GAAG,MAAMC,YAAO,CAAC,MAAM,CAAC,CAAA;AAEtC,QAAA,IAAI,QAAQ,EAAE;AACZ,YAAA,IAAI,CAAC,EAAE,CAAC,UAAU,CAACC,eAAU,CAAC,EAAE;AAC9B,gBAAA,EAAE,CAAC,SAAS,CAACC,MAAI,CAAC,OAAO,CAACD,eAAU,CAAC,EAAE,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,CAAA;AAC1D,aAAA;AAED,YAAA,EAAE,CAAC,aAAa,CAACA,eAAU,EAAEE,UAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAA;AAEpD,YAAA,IAAI,CAAC,EAAE,CAAC,UAAU,CAACC,kBAAa,CAAC,EAAE;AACjC,gBAAA,EAAE,CAAC,SAAS,CAACF,MAAI,CAAC,OAAO,CAACE,kBAAa,CAAC,EAAE,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,CAAA;AAC7D,aAAA;YAED,EAAE,CAAC,aAAa,CACdA,kBAAa,EACbD,UAAI,CAAC,SAAS,CAAC;gBACb,QAAQ,EAAE,MAAM,CAAC,OAAO;gBACxB,KAAK,EAAE,MAAM,CAAC,KAAK;AACpB,aAAA,CAAC,CACH,CAAA;YAED,EAAE,CAAC,aAAa,CAACE,uBAAkB,EAAE,CAAkB,eAAA,EAAA,MAAM,CAAC,KAAK,CAAE,CAAA,CAAC,CAAA;YAEtE,OAAM;AACP,SAAA;AAED,QAAA,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAA;QAC/B,OAAM;AACP,KAAA;AAAC,IAAA,OAAO,KAAK,EAAE;AACd,QAAA,MAAM,OAAO,GAAG,KAAK,YAAY,KAAK,GAAG,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC,CAAA;AACtE,QAAAC,0BAAc,CAAC,OAAO,CAAC,CAAA;AACvB,QAAA,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;QAClB,OAAM;AACP,KAAA;AACH,CAAC;AAED,KAAK,GAAG,EAAE;;"}