{"version":3,"file":"login-main.js","sources":["../src/actions/login/login-main.ts"],"sourcesContent":["import fs from 'fs'\nimport path from 'path'\n\nimport * as core from '@actions/core'\nimport YAML from 'yaml'\n\nimport {\n  cliConfigPath,\n  cliCredentialsPath,\n  configPath\n} from '../../constants/path'\nimport {JiraConfig} from '../../types'\nimport {getRequiredEnvParam} from '../../utils/action'\n\nimport execute from './login-execute'\n\nasync function run(): Promise<void> {\n  try {\n    const config: JiraConfig = {\n      baseUrl: getRequiredEnvParam('JIRA_BASE_URL'),\n      email: getRequiredEnvParam('JIRA_USER_EMAIL'),\n      token: getRequiredEnvParam('JIRA_API_TOKEN')\n    }\n\n    const response = await execute(config)\n\n    if (response.status !== 200) {\n      console.log('Failed to login.')\n\n      return\n    }\n\n    console.log(`Logged in as: ${response.data.displayName}`)\n\n    if (!fs.existsSync(configPath)) {\n      fs.mkdirSync(path.dirname(configPath), {recursive: true})\n    }\n\n    fs.writeFileSync(configPath, YAML.stringify(config))\n\n    if (!fs.existsSync(cliConfigPath)) {\n      fs.mkdirSync(path.dirname(cliConfigPath), {recursive: true})\n    }\n\n    fs.writeFileSync(\n      cliConfigPath,\n      YAML.stringify({\n        endpoint: config.baseUrl,\n        login: config.email\n      })\n    )\n\n    fs.writeFileSync(cliCredentialsPath, `JIRA_API_TOKEN=${config.token}`)\n\n    return\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error)\n    core.setFailed(message)\n    console.log(error)\n    return\n  }\n}\n\nvoid run()\n"],"names":["getRequiredEnvParam","execute","configPath","path","YAML","cliConfigPath","cliCredentialsPath","core.setFailed"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,eAAe,GAAG,GAAA;IAChB,IAAI;AACF,QAAA,MAAM,MAAM,GAAe;AACzB,YAAA,OAAO,EAAEA,0BAAmB,CAAC,eAAe,CAAC;AAC7C,YAAA,KAAK,EAAEA,0BAAmB,CAAC,iBAAiB,CAAC;AAC7C,YAAA,KAAK,EAAEA,0BAAmB,CAAC,gBAAgB,CAAC;SAC7C,CAAA;AAED,QAAA,MAAM,QAAQ,GAAG,MAAMC,YAAO,CAAC,MAAM,CAAC,CAAA;AAEtC,QAAA,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AAC3B,YAAA,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAA;YAE/B,OAAM;AACP,SAAA;QAED,OAAO,CAAC,GAAG,CAAC,CAAiB,cAAA,EAAA,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAE,CAAA,CAAC,CAAA;AAEzD,QAAA,IAAI,CAAC,EAAE,CAAC,UAAU,CAACC,eAAU,CAAC,EAAE;AAC9B,YAAA,EAAE,CAAC,SAAS,CAACC,MAAI,CAAC,OAAO,CAACD,eAAU,CAAC,EAAE,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,CAAA;AAC1D,SAAA;AAED,QAAA,EAAE,CAAC,aAAa,CAACA,eAAU,EAAEE,UAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAA;AAEpD,QAAA,IAAI,CAAC,EAAE,CAAC,UAAU,CAACC,kBAAa,CAAC,EAAE;AACjC,YAAA,EAAE,CAAC,SAAS,CAACF,MAAI,CAAC,OAAO,CAACE,kBAAa,CAAC,EAAE,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,CAAA;AAC7D,SAAA;QAED,EAAE,CAAC,aAAa,CACdA,kBAAa,EACbD,UAAI,CAAC,SAAS,CAAC;YACb,QAAQ,EAAE,MAAM,CAAC,OAAO;YACxB,KAAK,EAAE,MAAM,CAAC,KAAK;AACpB,SAAA,CAAC,CACH,CAAA;QAED,EAAE,CAAC,aAAa,CAACE,uBAAkB,EAAE,CAAkB,eAAA,EAAA,MAAM,CAAC,KAAK,CAAE,CAAA,CAAC,CAAA;QAEtE,OAAM;AACP,KAAA;AAAC,IAAA,OAAO,KAAK,EAAE;AACd,QAAA,MAAM,OAAO,GAAG,KAAK,YAAY,KAAK,GAAG,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC,CAAA;AACtE,QAAAC,0BAAc,CAAC,OAAO,CAAC,CAAA;AACvB,QAAA,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;QAClB,OAAM;AACP,KAAA;AACH,CAAC;AAED,KAAK,GAAG,EAAE;;"}