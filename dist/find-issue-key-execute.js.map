{"version":3,"file":"find-issue-key-execute.js","sources":["../src/actions/find-issue-key/find-issue-key-execute.ts"],"sourcesContent":["import _ from 'lodash'\n\nimport Jira from '../../services/jira'\nimport getGithubEvent from '../../utils/get-github-event'\n\nconst issueIdRegEx = /([a-zA-Z0-9]+-[0-9]+)/g\n\nconst preprocessString = (str: string, githubEvent) => {\n  _.templateSettings.interpolate = /{{([\\s\\S]+?)}}/g\n  const tmpl = _.template(str)\n\n  return tmpl({event: githubEvent})\n}\n\nasync function execute(config, inputString: string) {\n  const githubEvent = getGithubEvent()\n\n  const jiraInstance = new Jira({\n    baseUrl: config.baseUrl,\n    email: config.email,\n    token: config.token\n  })\n\n  const extractString = preprocessString(inputString, githubEvent)\n  const match = extractString.match(issueIdRegEx)\n\n  if (!match) {\n    console.log(`String \"${extractString}\" does not contain issueKeys`)\n\n    return\n  }\n\n  for (const issueKey of match) {\n    const response = await jiraInstance.getIssue(issueKey)\n\n    if (response) {\n      return {issue: response.body.key}\n    }\n  }\n\n  return null\n}\n\nexport default execute\n"],"names":["_","Jira"],"mappings":";;;;;;;;;;;;;;;AAKA,MAAM,YAAY,GAAG,wBAAwB,CAAA;AAE7C,MAAM,gBAAgB,GAAG,CAAC,GAAW,EAAE,WAAW,KAAI;AACpD,IAAAA,QAAC,CAAC,gBAAgB,CAAC,WAAW,GAAG,iBAAiB,CAAA;IAClD,MAAM,IAAI,GAAGA,QAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAA;IAE5B,OAAO,IAAI,CAAC,EAAC,KAAK,EAAE,WAAW,EAAC,CAAC,CAAA;AACnC,CAAC,CAAA;AAED,eAAe,OAAO,CAAC,MAAM,EAAE,WAAmB,EAAA;AAChD,IAAA,MAAM,WAAW,GAAG,cAAc,EAAE,CAAA;AAEpC,IAAA,MAAM,YAAY,GAAG,IAAIC,IAAI,CAAC;QAC5B,OAAO,EAAE,MAAM,CAAC,OAAO;QACvB,KAAK,EAAE,MAAM,CAAC,KAAK;QACnB,KAAK,EAAE,MAAM,CAAC,KAAK;AACpB,KAAA,CAAC,CAAA;IAEF,MAAM,aAAa,GAAG,gBAAgB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAA;IAChE,MAAM,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC,YAAY,CAAC,CAAA;IAE/C,IAAI,CAAC,KAAK,EAAE;AACV,QAAA,OAAO,CAAC,GAAG,CAAC,WAAW,aAAa,CAAA,4BAAA,CAA8B,CAAC,CAAA;QAEnE,OAAM;AACP,KAAA;AAED,IAAA,KAAK,MAAM,QAAQ,IAAI,KAAK,EAAE;QAC5B,MAAM,QAAQ,GAAG,MAAM,YAAY,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAA;AAEtD,QAAA,IAAI,QAAQ,EAAE;YACZ,OAAO,EAAC,KAAK,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAC,CAAA;AAClC,SAAA;AACF,KAAA;AAED,IAAA,OAAO,IAAI,CAAA;AACb;;;;"}